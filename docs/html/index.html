
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ncio - work easily with netcdf files &#8212; ncio</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=628480d8" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=b99859c3"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'index';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="api.html" />
    <link rel="prev" title="Contents" href="contents.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="contents.html">
  
  
  
  
  
  
    <p class="title logo__title">ncio</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">ncio - work easily with netcdf files</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="ncinfo.html">netcdf info</a></li>
<li class="toctree-l2"><a class="reference internal" href="ncread.html">read netcdf</a></li>
<li class="toctree-l2"><a class="reference internal" href="netcdfio.html">Copy netcdf files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/mcuntz/ncio" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mcuntz/ncio/edit/main/docs/index.rst" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mcuntz/ncio/issues/new?title=Issue%20on%20page%20%2Findex.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/index.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>ncio - work easily with netcdf files</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-ncio">About ncio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#documentation">Documentation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#copy-file">copy_file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#individual-copy-routines">Individual copy routines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation">Installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#license">License</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="ncio-work-easily-with-netcdf-files">
<span id="quickstart"></span><h1>ncio - work easily with netcdf files<a class="headerlink" href="#ncio-work-easily-with-netcdf-files" title="Link to this heading">#</a></h1>
<p>A small Python library providing functions to copy easily a netcdf
file while replacing and transforming variables and dimensions.</p>
<p><a class="reference external" href="https://doi.org/10.5281/zenodo.3893705"><img alt="DOI" src="https://zenodo.org/badge/DOI/10.5281/zenodo.3893705.svg" /></a> <a class="reference external" href="https://badge.fury.io/py/ncio"><img alt="PyPI version" src="https://badge.fury.io/py/ncio.svg" /></a> <a class="reference external" href="https://anaconda.org/conda-forge/ncio"><img alt="Conda version" src="https://anaconda.org/conda-forge/ncio/badges/version.svg" /></a> <a class="reference external" href="https://github.com/mcuntz/ncio/blob/master/LICENSE"><img alt="License" src="http://img.shields.io/badge/license-MIT-blue.svg?style=flat" /></a> <a class="reference external" href="https://github.com/mcuntz/ncio/actions"><img alt="Build Status" src="https://github.com/mcuntz/ncio/workflows/Continuous%20Integration/badge.svg?branch=master" /></a> <a class="reference external" href="https://coveralls.io/github/mcuntz/ncio?branch=master"><img alt="Coverage Status" src="https://coveralls.io/repos/github/mcuntz/ncio/badge.svg?branch=master" /></a></p>
<section id="about-ncio">
<h2>About ncio<a class="headerlink" href="#about-ncio" title="Link to this heading">#</a></h2>
<p><strong>ncio</strong> is a Python library that provides functions to copy
dimensions, variables, attributes, etc. from one netcdf file to a
netcdf output file. Replacements and transformations can be performed
on the copied entities such as names can be changed or variables can
be replaced with other data. It is a thin wrapper of the <a class="reference external" href="https://unidata.github.io/netcdf4-python/">netCDF4</a>
Python package that adds no new functionality but rather provides
convenience functions to work easily with netcdf files.</p>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">#</a></h2>
<p>The complete documentation for <strong>ncio</strong> is available at Github
pages:</p>
<blockquote>
<div><p><a class="reference external" href="https://mcuntz.github.io/ncio/">https://mcuntz.github.io/ncio/</a></p>
</div></blockquote>
</section>
<section id="copy-file">
<h2>copy_file<a class="headerlink" href="#copy-file" title="Link to this heading">#</a></h2>
<p><strong>ncio</strong> provides the functions <code class="docutils literal notranslate"><span class="pre">ncio.copy_dimensions</span></code>,
<code class="docutils literal notranslate"><span class="pre">ncio.copy_global_attributes</span></code>, and <code class="docutils literal notranslate"><span class="pre">ncio.copy_variables</span></code> to copy
dimensions, attributes, and variables from one netcdf file to
another. The functions have the keywords <cite>renamedim</cite>, <cite>removedim</cite>,
<cite>changedim</cite>, <cite>adddim</cite>, <cite>renamevar</cite>, <cite>removevar</cite>, <cite>replacevar</cite>, and
<cite>replaceatt</cite>, which purpose should be rather mnemonic. There is also
the function <code class="docutils literal notranslate"><span class="pre">ncio.copy_file</span></code> that combines the three individual
routines in a single function.</p>
<p>Imagine you have a netcdf file that contains the variable <cite>gpp</cite>, among
others. You want to have an output file, which is the same as the
input file except that <cite>gpp</cite> should be doubled. This could be done,
for example, as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ncio</span>

<span class="n">ifile</span> <span class="o">=</span> <span class="s1">&#39;basic_gpp.nc&#39;</span>
<span class="n">ofile</span> <span class="o">=</span> <span class="s1">&#39;gppx2.nc&#39;</span>

<span class="c1"># read current &#39;gpp&#39; array</span>
<span class="n">gpp</span> <span class="o">=</span> <span class="n">ncio</span><span class="o">.</span><span class="n">ncread</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="s1">&#39;gpp&#39;</span><span class="p">)</span>

<span class="c1"># copy file by replacing gpp by double its value</span>
<span class="n">ncio</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">replacevar</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gpp&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;gpp&#39;</span><span class="p">:</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">gpp</span><span class="p">}})</span>
</pre></div>
</div>
<p>Here the convenience function <code class="docutils literal notranslate"><span class="pre">ncio.ncread</span></code> was used that simply reads
the given variable from a netcdf file.</p>
<p>There is also the convenience function <code class="docutils literal notranslate"><span class="pre">ncio.ncinfo</span></code>, where one can
inquire about <cite>dimensions</cite> in the file, <cite>variables</cite>, their
<cite>long_names</cite> and <cite>units</cite> or all attributes. One could, for example,
assert that the variable gpp is present before reading it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># read current &#39;gpp&#39; array</span>
<span class="k">assert</span> <span class="s1">&#39;gpp&#39;</span> <span class="ow">in</span> <span class="n">ncio</span><span class="o">.</span><span class="n">ncinfo</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s1">&#39;Variable &quot;gpp&quot; not in input file </span><span class="si">{</span><span class="n">ifile</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">gpp</span> <span class="o">=</span> <span class="n">ncio</span><span class="o">.</span><span class="n">ncread</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="s1">&#39;gpp&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you set the keyword <cite>noclose=True</cite> in <code class="docutils literal notranslate"><span class="pre">ncio.copy_file</span></code>, then it
does not close the file and returns the file handle. You can then
still manipulate the contents of the file. The doubling of gpp could
hence also be done as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ncio</span>

<span class="n">ifile</span> <span class="o">=</span> <span class="s1">&#39;basic_gpp.nc&#39;</span>
<span class="n">ofile</span> <span class="o">=</span> <span class="s1">&#39;gppx2.nc&#39;</span>

<span class="c1"># read current &#39;gpp&#39; array</span>
<span class="k">assert</span> <span class="s1">&#39;gpp&#39;</span> <span class="ow">in</span> <span class="n">ncio</span><span class="o">.</span><span class="n">ncinfo</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s1">&#39;Variable &quot;gpp&quot; not in input file </span><span class="si">{</span><span class="n">ifile</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">gpp</span> <span class="o">=</span> <span class="n">ncio</span><span class="o">.</span><span class="n">ncread</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="s1">&#39;gpp&#39;</span><span class="p">)</span>

<span class="c1"># copy file, then directly access gpp variable in putput file</span>
<span class="n">fo</span> <span class="o">=</span> <span class="n">ncio</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">noclose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ovar</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;gpp&#39;</span><span class="p">]</span>
<span class="n">ovar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">ovar</span><span class="p">[:]</span> <span class="o">*</span> <span class="mf">2.</span>
<span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>A slightly extended example could be to produce a suite of scenarios
with respiration (resp) having global annual values between say 120
and 170 and the spatial pattern of gpp. If the input file has monthly
global gpp fields for several years, this would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ncio</span>

<span class="n">ifile</span> <span class="o">=</span> <span class="s1">&#39;basic_gpp.nc&#39;</span>

<span class="c1"># read current &#39;gpp&#39; array</span>
<span class="k">assert</span> <span class="s1">&#39;gpp&#39;</span> <span class="ow">in</span> <span class="n">ncio</span><span class="o">.</span><span class="n">ncinfo</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s1">&#39;Variable &quot;gpp&quot; not in input file </span><span class="si">{</span><span class="n">ifile</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">gpp</span> <span class="o">=</span> <span class="n">ncio</span><span class="o">.</span><span class="n">ncread</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="s1">&#39;gpp&#39;</span><span class="p">)</span>
<span class="n">isglobalgpp</span> <span class="o">=</span> <span class="n">gpp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="mf">12.</span>

<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">140</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">170</span><span class="p">]:</span>
    <span class="n">ofile</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;resp</span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s1">.nc&#39;</span>
    <span class="n">hist</span>  <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Modified </span><span class="si">{</span><span class="n">ifile</span><span class="si">}</span><span class="s1"> to produce resp with the distribution&#39;</span>
             <span class="sa">f</span><span class="s1">&#39; of gpp but with an annual mean of </span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s1"> PgC/a.&#39;</span><span class="p">)</span>
    <span class="n">ncio</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span>
                   <span class="n">replacevar</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gpp&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;resp&#39;</span><span class="p">:</span> <span class="n">gpp</span> <span class="o">*</span> <span class="p">(</span><span class="n">g</span> <span class="o">/</span> <span class="n">isglobalgpp</span><span class="p">)}},</span>
                   <span class="n">replaceatt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;resp&#39;</span><span class="p">:</span>
                                  <span class="p">{</span><span class="s1">&#39;long_name&#39;</span><span class="p">:</span>
                                   <span class="s1">&#39;Terrestrial Ecosystem Respiration&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;kg gridcell-1 s-1&#39;</span><span class="p">}},</span>
                    <span class="n">addglobalatt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;history&#39;</span><span class="p">:</span> <span class="n">hist</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="individual-copy-routines">
<h2>Individual copy routines<a class="headerlink" href="#individual-copy-routines" title="Link to this heading">#</a></h2>
<p>Using the individual functions gives more flexibility, of
course. Imagine you have an input file that has monthly fields on a
global grid on Earth, i.e. having dimensions <cite>(time, lon, lat)</cite>. The
land grid cells of the vegetation variables have the extra dimension
<cite>patch</cite> for fractions of different plant functional types in the same
grid cell, i.e. having dimensions <cite>(time, lon, lat, patch)</cite> or <cite>(time,
patch, lon, lat)</cite>. There is an associated variable <cite>patchfrac</cite> that
gives the fixed relative sizes of each patch. To get the average of
the grid cell, the vegetation variables have to be multiplied by
<cite>patchfrac</cite> and summed over the <cite>patch</cite> dimension. We will first set
all metadata in the output file, then copy the variables that have no
unlimited dimension <cite>time</cite>, and then the variables having a <cite>time</cite>
dimensions. The latter will be copied timestep per timestep to avoid
Python swapping variables to disk or out-of-memory:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">netCDF4</span> <span class="k">as</span> <span class="nn">nc</span>
<span class="kn">import</span> <span class="nn">ncio</span>

<span class="n">ifile</span> <span class="o">=</span> <span class="s1">&#39;patch.nc&#39;</span>
<span class="n">ofile</span> <span class="o">=</span> <span class="s1">&#39;nopatch.nc&#39;</span>

<span class="c1"># check input file</span>
<span class="k">assert</span> <span class="s1">&#39;patchfrac&#39;</span> <span class="ow">in</span> <span class="n">ncio</span><span class="o">.</span><span class="n">ncinfo</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s1">&#39;No patchfrac variable in input file </span><span class="si">{</span><span class="n">ifile</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;patch&#39;</span> <span class="ow">in</span> <span class="n">ncio</span><span class="o">.</span><span class="n">ncinfo</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;patchfrac&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># open input and output files</span>
<span class="n">fi</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="s1">&#39;file_format&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">fi</span><span class="p">):</span>
    <span class="n">fo</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">fi</span><span class="o">.</span><span class="n">file_format</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">fo</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF3_64BIT_OFFSET&#39;</span><span class="p">)</span>

<span class="c1"># copy global attributes, adding script</span>
<span class="n">ncio</span><span class="o">.</span><span class="n">copy_global_attributes</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span> <span class="n">fo</span><span class="p">,</span>
                            <span class="n">add</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;history&#39;</span><span class="p">:</span> <span class="p">(</span>
                                   <span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span>
                                   <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">))})</span>

<span class="c1"># copy dimensions</span>
<span class="n">ncio</span><span class="o">.</span><span class="n">copy_dimensions</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span> <span class="n">fo</span><span class="p">,</span> <span class="n">removedim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;patch&#39;</span><span class="p">])</span>

<span class="c1"># create static variables (independent of time)</span>
<span class="n">ncio</span><span class="o">.</span><span class="n">create_variables</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span> <span class="n">fo</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">removedim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;patch&#39;</span><span class="p">])</span>

<span class="c1"># create dynamic variables (time dependent)</span>
<span class="n">ncio</span><span class="o">.</span><span class="n">create_variables</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span> <span class="n">fo</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">removedim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;patch&#39;</span><span class="p">])</span>

<span class="c1"># get patchfrac</span>
<span class="n">patchfrac</span> <span class="o">=</span> <span class="n">fi</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;patchfrac&#39;</span><span class="p">]</span>

<span class="c1"># copy static variables</span>
<span class="k">for</span> <span class="n">ivar</span> <span class="ow">in</span> <span class="n">fi</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ivar</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
        <span class="n">ovar</span>  <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">ivar</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">invar</span> <span class="o">=</span> <span class="n">ivar</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="s1">&#39;patch&#39;</span> <span class="ow">in</span> <span class="n">ivar</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">ivar</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;patch&#39;</span><span class="p">)</span>
            <span class="c1"># use patchfrac at first time step for non-time</span>
            <span class="c1"># dependent variables</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">invar</span> <span class="o">*</span> <span class="n">patchfrac</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">invar</span>
        <span class="n">ovar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">out</span>

<span class="c1"># copy dynamic variables</span>
<span class="n">ntime</span> <span class="o">=</span> <span class="n">fi</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
<span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntime</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ivar</span> <span class="ow">in</span> <span class="n">fi</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">ivar</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="n">ovar</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">ivar</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">invar</span> <span class="o">=</span> <span class="n">ivar</span><span class="p">[</span><span class="n">tt</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;patch&#39;</span> <span class="ow">in</span> <span class="n">ivar</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
                <span class="c1"># -1 because of specific timestep</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">ivar</span><span class="o">.</span><span class="n">dimensions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;patch&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">invar</span> <span class="o">*</span> <span class="n">patchfrac</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">invar</span>
            <span class="n">ovar</span><span class="p">[</span><span class="n">tt</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>

<span class="c1"># finish</span>
<span class="n">fi</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">#</a></h2>
<p>The easiest way to install is via <cite>pip</cite>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>ncio
</pre></div>
</div>
<p>or via <cite>conda</cite>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>ncio
</pre></div>
</div>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.numpy.org">NumPy</a></p></li>
<li><p><a class="reference external" href="https://unidata.github.io/netcdf4-python/">netCDF4</a></p></li>
</ul>
</section>
<section id="license">
<h2>License<a class="headerlink" href="#license" title="Link to this heading">#</a></h2>
<p><strong>ncio</strong> is distributed under the MIT License. See the <a class="reference external" href="https://github.com/mcuntz/ncio/LICENSE">LICENSE</a> file
for details.</p>
<p>Copyright (c) 2020- Matthias Cuntz</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="contents.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Contents</p>
      </div>
    </a>
    <a class="right-next"
       href="api.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">API Reference</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-ncio">About ncio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#documentation">Documentation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#copy-file">copy_file</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#individual-copy-routines">Individual copy routines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation">Installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements">Requirements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#license">License</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Matthias Cuntz
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2020-2024, Matthias Cuntz.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>